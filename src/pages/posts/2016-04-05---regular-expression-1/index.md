---
title: "正则表达式核心"
date: "2016-04-05"
tags: ["regular expression"]
---
# 正则表达式核心

若有多个字符串，其中一个字符串中包含部分内容，我们使用正则来进行匹配，匹配的结果到底什么？是包含匹配内容的那个字符串？还是只有匹配的内容？

Go Ahead~

正则表达式的核心概念就是元字符，它一点也不复杂，掌握了元字符，就可以正则表达式的能力有所了解。

接下来的每一节，我都会介绍数个元字符，最终本文结束时，读者就会对正则表达式的核心元字符有大概的了解。

## 从 hi, Hao 开始

`hi, Hao`这样一个字符串，如果使用正则表达式匹配到`hi`？这非常简单，我们使用`js`来作为实现语言：

```js
let p = /hi/;
let s = `hi, HAO`;
s.match(p); // ["hi", index: 0, input: "hi,Hao"]
```

逐行分析：

1. 使用`/code/`这样的语法，告诉`js`解释引擎，这是一个正则表达式，其中的`hi`就是正则表达式的实际内容
1. 声明赋值一个字符串
1. 使用`match`方法匹配，它将返回一个数组，其中存放了与它找到的匹配文本有关的信息。该数组的第`0`个元素存放的是匹配文本，而其余的元素存放的是与正则表达式的子表达式匹配的文本。除了这些常规的数组元素之外，返回的数组还含有两个对象属性。`index`属性声明的是匹配文本的起始字符在原字符串中的位置，`input`属性声明的是对原字符串的引用。

上面太简单了，但如果遇到这样的情况呢？

```js
let s = `hi,this is Hao. hi, this is Liu.`;
```

这里面的`hi`，我全都要，该如何匹配？之前的正则表达式是否可行呢？

```js
s.match(/hi/) // ["hi", index: 0, input: "hi,this is Hao. hi, this is Liu."]
```

很明显，没有用了，仍然只捕捉到一个结果。为了解决这个问题，我们引入全局标志`g`，使用`g`，`match`方法将执行全局检索，找到原字符串中所有匹配子字符串。若没有找到任何匹配的子串，则返回`null`。如果找到了一个或多个匹配子串，则返回一个数组。不过全局匹配返回的数组的内容与前者大不相同，它的数组元素中存放的是原字符串中所有的匹配子串，而且也没有`index`属性和`input`属性。

```js
s.match(/hi/g) // (4) ["hi", "hi", "hi", "hi"]
```

成功了。

挑剔的人来了，如果只想匹配到下面这个字符串最中间的`hi`呢？

```js
let s = `this is Hao. hi this is Liu.`;
```

我们这里就需要用正则表达式的核心内容，元字符了，直接看例子，



```js
s.match(/hi/) // ["hi", index: 1, input: "this is Hao. hi this is Liu."]
s.match(/\bhi\b/) //["hi", index: 13, input: "this is Hao. hi this is Liu."]
```

逐行分析：

1. 第一行使用了老方法妄图匹配中间的`hi`，但在遇到索引位置`1`开始的`hi`时，就匹配完成了，老方法显然无法满足要求
1. 第二种方法从结果上看匹配成功了，匹配到了索引位置`13`处开始的`hi`，我们分析一下这个正则表达式中有什么。抛除熟悉的`\ hi \`，我们发现了`hi`左右的`\b \b`，这便是元字符，`\`用来告诉计算机这是元字符，区别于普通的字符串。`b`元字符可以匹配这样的位置，这个位置的前一个字符和后一个字符不全是字母、数字、下划线、汉字。分析一下会发现第一个`hi`在`this`中，很明显，子串`hi`的前后字符都是字母，不满足要求。到了索引为`13`出的`hi`，它的前后是空格，不是字母、数字、下划线或者汉字，`b`元字符要求`hi`的前一个字符和后一个字符不全是字母、数字、下划线、汉字。这里都是空格，这可高于要求的`不全是`，都已经`全都不是`了，当然满足了，匹配成功。

|元字符|作用|
|-|-|
|b|所匹配的位置，前一个字符和后一个字符不全是`w`(`w`用来匹配字母、数字、下划线、汉字)|

## .*元字符

匹配`hi`还是容易的，但如果想匹配一大段内容呢？比如

```js
let s = `hi! .................... I'm Lucy! I may be a pink ostrich but I'm still a kid just like you! I love  tell jokes, laugh, sing, watch cartoons and learn! And I get to do all these things in class with Sr. Grace! She's my favorite teacher in the whole world. `;
```

上面的省略号代表非常多的内容。假如我想要匹配`hi`与`Lucy`连同它中间的内容呢？我总不能都放到正则表达式吧，那多丑！
我们这里又要使用元字符了

```js
s.match(/\bhi\b.*\bLucy\b/) //succ
```

这里面的有两三点要说明：

1. `.*`也算元字符？是的，这是两个元字符，只不过他们没有加`\`而已。
1. 为什么不加`\`标志符？因为他们太常用了，干脆就省略`\`了，反而专门要匹配字符串`.`与`*`的场合却很少，干脆将正则表达式与字符串的表示反一下，如果想要匹配`.`这个字符串，那么为它加上`\`，即`\.`，`\*`也是同理。
1. `.*`代表什么含义？请看下面的表格

|元字符|作用|
|-|-|
|.|匹配除了换行符之外的任何字符|
|*|用来指定这个元字符 * 前面的内容可以连续重复使用任意多次，可以使得整个表达式得到匹配|

看到这个表格你应该明了了，`.*`用来表示任何数量的字符，只要字符里边不包括换行，于是 \bhi\b.*\bLucy\b 就表示先有个单词`hi`，接着允许出现很多字符，除了换行，之后有一个单词`Lucy`。

## 电话号码的匹配实例

`0\d\d\d-\d\d\d\d\d\d\d\d` 用来匹配`0`开头，之后3位数字加`-`，之后8位数字的电话号码。使用这么多的`\d`是一件很让人上头的事情，可以使用这样的写法：`0\d{3}-\d{8}`。

|元字符|作用|
|-|-|
|d|匹配一位数字,比如 0 ，1 ，2 等任意的一位数字|
|{n}|用来指定这个元字符`*`前面的内容可以连续重复使用任意多次，可以使得整个表达式得到匹配|

## 其他常用元字符

|元字符|作用|
|-|-|
|/s|匹配任意多的空白符|
|/w|代表着可用文字，包含字母，数字，下划线，汉字|
|/s|匹配任意多的空白符|
|+|与`{n}`、`*`类似，指定当前元字符前面的内容重复多次，`+`专指重复`1`次以上|

## 番外

现在好多内容在讲正则的时候都不注意区分哪些是核心内容，在很多环境下，编程语言会对正则做出拓展，引入了很多新符号，引入了很多的复杂度，对初学者不友好。下面推荐一些文章

- 谷歌大牛的文章：[编程珠玑番外篇-C.正则表达式精义-1](http://blog.youxu.info/2009/03/05/ree1/)
- 进阶：[跟vczh看实例学编译原理——零：序言](http://www.cppblog.com/vczh/archive/2014/01/19/205468.html)
- 这是一个图形化的在线正则展示网页，可以用来测试正则：[Regexper](https://regexper.com/)